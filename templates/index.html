<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TF2dle: Guess a TF2 Weapon!</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        h1 {
            margin-top: 50px;
            font-size: 2.5em;
        }
        #search-container {
            margin-top: 20px;
            position: relative;
            display: inline-block; /* Center the search container */
        }
        input[type="text"] {
            padding: 10px;
            font-size: 1.2em;
            width: 300px;
        }
        #dropdown {
            margin-top: 10px;
            background-color: white;
            color: black;
            width: 300px;
            text-align: left;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
            display: none;
        }
        .dropdown-item {
            padding: 10px;
            cursor: pointer;
        }
        .dropdown-item:hover {
            background-color: #ddd;
        }
        #guesses-table {
            margin-top: 30px;
            width: 60%;
            border-collapse: collapse;
            margin-left: auto;
            margin-right: auto;
        }
        #guesses-table th, #guesses-table td {
            padding: 12px;
            border: 1px solid #ccc;
        }
        #guesses-table th {
            background-color: #333;
            color: white;
        }
        #guesses-table td {
            background-color: white;
            color: black;
        }
        #settingsMenu {
        display: none; /* Hide settings menu by default */
        position: absolute; /* Allow it to float above other content */
        top: 10%; /* Position from the top */
        right: 10%; /* Position from the right */
        background-color: white; /* White background for settings menu */
        color: black; /* Black text color for settings menu */
        border: 1px solid #ccc; /* Optional: add a border */
        padding: 10px; /* Add some padding */
        z-index: 1000; /* Make sure itâ€™s above other content */
      }
      .settingsButton {
        position: absolute;
        top: 10px; /* Position it at the top */
        right: 10px; /* Align it to the right */
        background-color: white; /* Button background */
        color: black; /* Button text color */
        border: 1px solid black; /* Button border */
        cursor: pointer; /* Change cursor to pointer on hover */
      }

      /* Add hover effects for better UX */
      .settingsButton:hover {
        background-color: #f0f0f0; /* Lighten on hover */
      }
    </style>
</head>
<body>

    <h1>TF2dle: Guess a TF2 Weapon!</h1>

    <div id="credits" style="position: absolute; top: 10px; left: 10px; color: white; margin:0; padding:0;">
      Created by Seth Grimes in 2024 using Python, HTML, CSS, and SQL.<br> 
     Deployed using a Gunicorn web dyno and web hosted using Heroku.
    </div>

    <!-- Container for the Replay Button -->
    <div id="replay-container" style="display: flex; justify-content: center; margin-top: 20px;">
      <button id="replay-button" style="display: none; padding: 20px; font-size: 18px;" onclick="resetGame()">Replay</button>
    </div>

    <!-- Settings button -->
    <button class="settingsButton" onclick="toggleSettingsMenu()">
      Settings
  </button>

  <!-- Settings menu -->
  <div id="settingsMenu">
      <h3>Settings</h3>
      <label for="fontSelect">Font:</label>
      <select id="fontSelect" onchange="changeFont()">
          <option value="Arial">Arial</option>
          <option value="Courier New">Courier New</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Georgia">Georgia</option>
          <option value="Verdana">Verdana</option>
      </select>
      <br /><br />
      <label for="fontSize">Font Size:</label>
      <input
          type="number"
          id="fontSize"
          value="16"
          onchange="changeFontSize()" />
      <br /><br />
      <label for="fontColor">Font Color:</label>
      <input type="color" id="fontColor" onchange="changeFontColor()" />
      <br /><br />
      <label for="backgroundColor">Background Color:</label>
      <input
          type="color"
          id="backgroundColor"
          onchange="changeBackgroundColor()" />
      <br /><br />
      <button onclick="toggleSettingsMenu()">Close</button>
  </div>


    <div id="search-container">
        <input type="text" id="search-box" placeholder="Type a weapon name..." autocomplete="off">
        <div id="dropdown"></div>
    </div>

    <!-- Table for tracking guesses -->
    <table id="guesses-table">
        <thead>
            <tr>
                <th>Weapon</th>
                <th>Class</th>
                <th>Slot</th>
            </tr>
        </thead>
        <tbody id="guesses-body">
        </tbody>
    </table>

    


    <script>
        let hiddenWeapon = null;
        let guessedWeapons = new Set();
        let numberOfGuesses = 0;

        // Fetch a random weapon from the server to start the game
        async function fetchRandomWeapon() {
            const response = await fetch('/api/weapons');
            const weapons = await response.json();
            hiddenWeapon = weapons[Math.floor(Math.random() * weapons.length)];
        }

        // Function to search for weapons as the user types
        async function searchWeapons(query) {
            if (query.trim() === '') {
                document.getElementById('dropdown').style.display = 'none';
                return;
            }

            const response = await fetch('/api/weapons');
            const weapons = await response.json();

            // Filter weapons by name based on user input
            const filteredWeapons = weapons.filter(weapon => weapon.name.toLowerCase().includes(query.toLowerCase()) && !guessedWeapons.has(weapon.name));

            const dropdown = document.getElementById('dropdown');
            dropdown.innerHTML = '';  // Clear previous results

            if (filteredWeapons.length > 0) {
                filteredWeapons.forEach(weapon => {
                    const item = document.createElement('div');
                    item.classList.add('dropdown-item');
                    item.textContent = weapon.name;
                    item.onclick = () => checkGuess(weapon);
                    dropdown.appendChild(item);
                });
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }

// Add a replay button after a correct guess
function checkGuess(weapon) {
    guessedWeapons.add(weapon.name);

    const guessesBody = document.getElementById('guesses-body');
    const newRow = document.createElement('tr');

    newRow.innerHTML = `
        <td style="background-color: ${weapon.name === hiddenWeapon.name ? 'green' : 'red'};">${weapon.name}</td>
        <td style="background-color: ${weapon.class === hiddenWeapon.class ? 'green' : 'red'};">${weapon.class}</td>
        <td style="background-color: ${weapon.slot === hiddenWeapon.slot ? 'green' : 'red'};">${weapon.slot}</td>
    `;

    guessesBody.appendChild(newRow);

    document.getElementById('dropdown').style.display = 'none';
    document.getElementById('search-box').value = '';

    // Check if the guessed weapon is correct
    if (weapon.name === hiddenWeapon.name) {
        alert(`Congratulations! You guessed correctly: ${hiddenWeapon.name}`);
        
        const replayButton = document.getElementById('replay-button');
        replayButton.style.display = 'block';
    }
}

// Function to reset the game
function resetGame() {
    // Fetch a new random weapon
    fetchRandomWeapon();
    document.getElementById('replay-button').style.display = 'none';

    // Clear the guess history table
    const guessesBody = document.getElementById('guesses-body');
    guessesBody.innerHTML = '';  // Removes all rows except for the header
    numberOfGuesses = 0;

    // Clear the guessed weapons set
    guessedWeapons.clear();
}


        // Event listener for the search box
        document.getElementById('search-box').addEventListener('input', (e) => {
            searchWeapons(e.target.value);
        });

        // Start the game by fetching a random weapon
        fetchRandomWeapon();
    </script>

</body>
</html>
